"0","# basin classifications"
"0","dt_basin_classif <- as.data.table(openxlsx::read.xlsx("
"0","  ""D:/DataWorking/GAGESii/basinchar_and_report_sept_2011/gagesII_sept30_2011_conterm.xlsx"","
"0","  sheet = ""Bas_Classif""))"
"0",""
"0","# Store initial number of reference and non-reference stations"
"0","ref_init <- nrow(dt_basin_classif[CLASS == ""Ref""])"
"0","nonref_init <- nrow(dt_basin_classif[CLASS == ""Non-ref""])"
"0",""
"0","# Load quality assurance tab and filter to basins with a basin boundary confidence >= 7"
"0","tmp_BndryCnfdnc <- as.data.table(openxlsx::read.xlsx("
"0","  ""D:/DataWorking/GAGESii/basinchar_and_report_sept_2011/gagesII_sept30_2011_conterm.xlsx"","
"0","  sheet = ""Bound_QA""))["
"0","    BASIN_BOUNDARY_CONFIDENCE >= 7"
"0","    ]"
"0",""
"0","# Load flow record tab from gagesII_sept30_2011_conterm.xlsx file"
"0","# 1 = full record for that year, 0 = not full record for that year"
"0","# Filter flowrec to those basins with boundary confidence >= 7"
"0","tmp_flowrec <- as.data.table(openxlsx::read.xlsx("
"0","  ""D:/DataWorking/GAGESii/basinchar_and_report_sept_2011/gagesII_sept30_2011_conterm.xlsx"","
"0","  sheet = ""FlowRec""))["
"0","    STAID %in% tmp_BndryCnfdnc$STAID"
"0","    ]["
"0","      , c(1, 87:116) # filtering to years 1976 through 2009"
"0","    ]"
"0",""
"0","# output data.table will have values for each year that are integer values"
"0","# representing the number of years from the current through the next four that "
"0","# have full flow records"
"0",""
"0","dt_contflow <- as.data.table("
"0","    lapply("
"0","      seq(4, ncol(tmp_flowrec), 1), "
"0","      function(i) {"
"0","        if(i == 4) {"
"0","          tmp_flowrec[, 1]"
"0","        } else {"
"0","        rowSums(tmp_flowrec[, (i - 3):i])"
"0","        } #close if-else"
"0","      } #close function"
"0","    ) # close lapply"
"0","  ) # closeas.data.table"
"0",""
"0",""
"0","colnames(dt_contflow) <- colnames(tmp_flowrec)[1:28]"
"0",""
"0","# define vector to hold staid's to keep (kp) with at least 1 group of 4 "
"0","# continuous years."
"0","tmp_kp <- c()"
"0",""
"0","# loop through rows of dt_contflow and return only rows that contain 4 "
"0","for(i in 1:nrow(dt_contflow)){"
"0","  if(4 %in% dt_contflow[i, 2:ncol(dt_contflow)]) {"
"0","    tmp_kp <- c(tmp_kp, dt_contflow[i, STAID])    "
"0","  }"
"0","}"
"0",""
"0","# return dt_contflow stations that have at least one 4"
"0","dt_contflow <- merge("
"0","  dt_contflow[STAID %in% tmp_kp],"
"0","  dt_basin_classif[,.(STAID, CLASS)], "
"0","  by = ""STAID"""
"0","   ) # close merge"
"0","  "
"0",""
"0","# Store number of non-reference and reference gauges after filtering to stations"
"0","# with >= 4 consecutive years of flow"
"0","ref_cntyrs <- nrow(dt_contflow[CLASS == ""Ref""])"
"0","nonref_cntyrs <- nrow(dt_contflow[CLASS == ""Non-ref""])"
"0",""
"0",""
"0","# load in tables to be used in idvars"
"0","# data table of variables to use for labeling in dimension reduction and/or"
"0","# clustering"
"0","tmp_idvars <- as.data.table(openxlsx::read.xlsx("
"0","  ""D:/DataWorking/GAGESii/basinchar_and_report_sept_2011/gagesII_sept30_2011_conterm.xlsx"","
"0","  sheet = ""Regions""))["
"0","    , .(STAID, ECO3_SITE, USDA_LRR_SITE)"
"0","  ]"
"0",""
"0","# create data table of variables to use for labeling in dimension reduction"
"0","# and/or clustering"
"0","tmp_idvars <- data.table("
"0","  ""STAID"" = dt_basin_classif$STAID,"
"0","  ""Class"" = dt_basin_classif$CLASS,"
"0","  ""AggEcoregion"" = dt_basin_classif$AGGECOREGION,"
"0","  ""ECO3_Site"" = tmp_idvars$ECO3_SITE,"
"0","  ""USDA_LRR_Site"" = tmp_idvars$USDA_LRR_SITE"
"0",")"
"0","  "
"0","# data.table::fwrite(tmp_idvars,"
"0","#         file = ""D:/Projects/GAGESii_ANNstuff/Data_Out/GAGES_idVars.csv"")"
"0","# remove tmp_flowrec and dt_BndryCnfd"
"0","rm(list = ls(pattern = ""tmp_""))"
